
### マッピング

  - > 目的・用途

本機能は、アイテムタイプマッピングを設定する機能である

  - > 利用方法

【Administration \> アイテムタイプ管理（Item Types） \> マッピング（Mapping）画面】にて操作する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

1 アイテムタイプマッピングを設定する

  - 【前提条件】  
    マッピングするOAI-PMHスキーマが【Administration \> アイテムタイプ管理 \> OAI Schema画面】に追加済み  
    OAI-PMHスキーマの追加については、[ADMIN-1-3: OAIスキーマ](\\l)を参照
    
      - デフォルトで設定できるマッピングは、以下の通りである。
        
          - jpcoar\_mapping：JPCOARスキーマに対応
        
          - jpcoar\_v1\_mapping：JPCOAR v1スキーマに対応
        
          - jpcoar\_v2\_mapping：JPCOAR v2スキーマに対応
        
          - oai\_dc\_mapping：Dublin Coreスキーマに対応
        
          - ddi\_mapping：DDIスキーマに対応
        
          - lom\_mapping：lomスキーマに対応

  - 「アイテムタイプリスト」（Item Type List）、「スキーマリスト」（Schema List）プルダウンを設ける
    
      - 「アイテムタイプリスト」（Item Type List）プルダウンに標準アイテムタイプとハーベスト用のアイテムタイプを表示する
        
          - デフォルトの値は1番上にあるアイテムタイプとする
        
          - 選択すると、該当アイテムタイプ項目が反映される
    
      - 「スキーマリスト」（Schema List）プルダウンに【Admin \> Item Types \> OAI Schema画面】に登録されたスキーマを表示する
        
          - デフォルトの値は「jpcoar\_mapping」とする
        
          - 選択すると、該当スキーマの項目と、表示しているアイテムタイプと設定済みマッピング情報が反映される

  - 「システムが付与したアイテムタイプ」（Item type added by system）、「アイテムタイプ」（Item Type）のマッピングエリアを設ける
    
      - 「システムが付与したアイテムタイプ」（Item type added by system）：システムが付与した項目のマッピングエリアである
    
      - 「アイテムタイプ」（Item Type）：アイテムタイプに設定された項目のマッピングエリアである

  - 「アイテムタイプ」（Item Type）のマッピングエリアはアイテムタイプ(親)とアイテムタイプ（子）エリアに分ける
    
      - アイテムタイプ(親)エリア
        
          - アイテムタイプ親要素の項目を表示する。並び順は アイテムタイプ画面の項目並び順と合わせる
        
          - 選択しているスキーマ親要素をプルダウンに表示する
            
              - アイテムタイプ子要素の項目とマッピングするため、スキーマ親要素の前にラジオボタンを設ける
            
              - 1つのアイテムタイプ親要素の項目が複数マッピングするため、各のアイテムタイプ親要素行に「追加」（Add）ボタンを設ける
                
                  - クリックすると、スキーマ親要素の選択プルダウンエリアを追加する
            
              - 各のアイテムタイプ親要素行の「×」ボタンを押すことで、該当スキーマ親要素の選択プルダウンエリアを削除する
    
      - アイテムタイプ(子)エリア
        
          - スキーマ親要素プルダウンより選択して、ラジオボタンをクリックすると、アイテムタイプ子要素の項目とスキーマ子要素の項目が画面の下部に表示される
        
          - スキーマ子要素の選択プルダウンは選択済みのものは非活性表示(選択不可)とし、同一項目を複数個設定できない
        
          - 複数アイテムタイプ子要素を1つのスキーマ子要素にマッピングできるため、「Join」ボタンを設ける
            
              - クリックすると、アイテムタイプ子要素の選択プルダウンエリアを追加する
            
              - また、DBに保存する時、各アイテムタイプ子要素を区切るため、文字を「入力欄」テキストボックスに入力する  
                対応している区切り文字はコンマ（","）である
            
              - joinの項目欄にコンマ（","）を入力することで、OAI-PMH出力で複数のタグとして出力される
        
          - 各アイテムタイプ子要素行にある「削除」（Delete）ボタンを押すことで、該当アイテムタイプ子要素行を削除する
        
          - アイテムタイプ子要素に対して固定値のメタデータをOAI-PMH出力させるために、「Add static value」ボタンを設ける。
            
              - クリックすると、アイテムタイプ子要素として新たに行が追加される。
            
              - この行の、「input static value」と表示されている欄に入力した内容は、OAI-PMH出力時に固定値として出力される。
            
              - この固定値を設定した場合でも、ワークフローのアクティビティ編集画面には空欄が表示される。また、この空欄に別の値を入力した場合は、コンテンツ詳細画面においてはその値が表示されるが、OAI-PMH出力のデータには固定値が出力される。

  - 「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを画面の上部に表示する  
    メッセージ：  
    日本語：「新しいマッピングを保存しました」  
    英語：「Successfully saved new mapping.」

2 システムが付与したアイテムタイプをマッピングする

  - 【前提条件】  
    マッピングするOAI-PMHスキーマが【Administration \> アイテムタイプ管理 \> OAI Schema画面】に追加済み

  - WEKOでのシステム操作を介して作成されるデータを、スキーマ項目に画面上でマッピング可能とする

  - 対象データは、以下とする
    
      - 永続識別子（DOI）
    
      - 永続識別子（HDL）
    
      - 永続識別子（URI）
    
      - ファイル情報

  - 【注意事項】
    
      - 永続識別子（DOI）に対して、他の永続識別子（HDL及びURI）の場合、OAI-PMH出力できる
    
      - ファイル情報に対して、ファイルURLがOAI-PMH出力できるために、［アイテムタイプ（親）］での［ファイル情報］または［課金ファイル情報］項目のマッピングとあわせて、JPCOARでのスキーマ（親）の［system\_file.URI］とマッピングする必要がある

3 マッピングが重複する場合

titleのマッピングが重複している場合は、プロパティの順序が一番先頭の値をアイテム詳細画面のタイトル、アイテム一覧のタイトル、Cite asのタイトルとして出力する。

  - OAI-PMH出力は重複したプロパティを独立して出力する。

4 公開日のマッピング

WEKO3の必須項目である「公開日」についてもマッピングすることでOAI-PMH出力をすることができる。

対応方針は以下の通り。

  - 【Administration \> アイテムタイプ管理 \> メタデータ画面】でアイテムタイプの"公開日"の「Hide」オプションがON（非表示とする）の場合
    
      - アイテムの「公開日」はOAI-PMH出力しない

  - 【Administration \> アイテムタイプ管理 \> メタデータ画面】でアイテムタイプの"公開日"の「Hide」オプションがOFF（表示する）の場合
    
      - アイテムの「公開日」をOAI-PMHに出力する

  - OAI-PMH出力にあたり、「公開日」のスキーマMappingは自由にできる（デフォルト設定はしない）ものとする  
    ※マッピングに「date」を設定した場合、(JPCOARとしては非推奨だが)DataTypeは未設定でdatacite:dateに公開日のみ出力する

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko-itemtypes-ui

<!-- end list -->

  - > 関連テーブル

<!-- end list -->

  - アイテムタイプリスト：item\_typeテーブルから取得したアイテムタイプ
    
      - １つアイテムタイプを選択する場合、item\_type\_mappingからのマッピング情報を読み取る

  - スキーマリスト：oaiserver\_schemaテーブルから取得したスキーマ一覧
    
      - １つスキーマを選択する場合、選択中のアイテムタイプと、選択中のスキーマに該当するマッピング情報を、item\_type\_mappingから読み取る

  - 画面の「保存」ボタンを押下する場合、画面に設定している情報をitem\_type\_mappingと、item\_type\_mapping\_versionテーブルに格納する

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - HTMLテンプレート
    
      - パス: <https://github.com/RCOSDP/weko/blob/hfix/modules/weko-itemtypes-ui/weko_itemtypes_ui/config.py#L37-L37>
        
          - 設定キー: WEKO\_ITEMTYPES\_UI\_ADMIN\_MAPPING\_TEMPLATE = \\  
            'weko\_itemtypes\_ui/admin/create\_mapping.html'  
            """Mapping template for the item type page."""

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2024/07/1</p>
</blockquote></td>
<td>7733de131da9ad59ab591b2df1c70ddefcfcad98</td>
<td>v1.0.7対応</td>
</tr>
</tbody>
</table>