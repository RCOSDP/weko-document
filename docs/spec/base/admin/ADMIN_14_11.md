# 検索設定

## 目的・用途

本機能は、管理者として、デフォルトで表示する検索結果表示及び使用可能な詳細検索条件について設定できる機能である。

## 利用方法

【Administration\>設定（Setting）\>検索設定（Search）】の順でSearch画面に遷移し、検索条件を設定し画面最下部右下にある\[保存(Save)\]ボタンを押下することで設定を反映させる。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

使用している画面

  - 【Administration\>設定（Setting）\>検索設定（Search）】：使用可能な詳細検索条件およびデフォルトで表示する検索結果表示を設定する画面である。

(1)Search Author Setting

  - アイテム詳細画面より、著者のリンクを押下後に表示されるポップアップ内にある"Search repository"リンクを押下した時の検索方法を設定する機能。

  - 以下のいずれかを設定する。初期値は「Search by Author Name」である。
    
      - 著者名で検索（Search by Author Name）:　著者の名前で検索をする。
    
      - 著者名IDで検索（Search by Author ID）:　著者のWEKO IDで検索をする。

  - > (2) 検索結果表示設定デフォルトで表示する検索結果表示及び使用可能な詳細検索条件について設定する。

  - デフォルトで表示する検索結果表示の設定について
    
      - ソート条件利⽤可否で設定できるソート項⽬は、以下とする。
        
          - Title(asc/desc)：タイトル（昇順／降順）
        
          - Creator(asc/desc)：登録者（昇順／降順）
        
          - Item Type(asc/desc)：アイテムタイプ名（昇順／降順）
        
          - ID (asc/desc)：ID（昇順／降順）
        
          - Update(asc/desc)：更新⽇時（昇順／降順）
        
          - Create(asc/desc)：作成⽇時（昇順／降順）
        
          - Date Of Issued(asc/desc)：出版年（昇順／降順）
        
          - Custom(asc/desc)：カスタム（昇順／降順）
        
          - Relevance(asc/desc)
        
          - Temporal(asc/desc)
    
      - 設定内容は以下とする。
        
          - 「検索結果表示設定」（Search Results Setting）
            
              - 「デフォルト表示件数」（Default Display Number）
                
                  - 選択肢：20、50、75、100
                
                  - デフォルト：20
            
              - 「デフォルトソート条件（インデックス検索）」（Default Display Sort (Index Search)）
                
                  - 選択肢：すべてのソート項⽬
                
                  - デフォルト：ID (asc)
            
              - 「デフォルトソート条件（キーワード検索）」（Default Display Sort (Keywords Search)）
                
                  - 選択肢：すべてのソート項⽬
                
                  - デフォルト：Create(desc)
            
              - 「一覧に表示するソート条件を設定してください」（Please set the sort of search results .）
                
                  - デフォルト：すべてのソート項⽬が利用可能として「表示する」（Allow）エリアに表示する。
                
                  - 「表示する」（Allow）エリアに表示している任意項目を選択し、\[→\]ボタンを押すと、選択項目を利用不可の項目とし、「表示しない」(Deny)エリアに移動する。
                
                  - 「表示しない」（Deny）エリアに表示している任意項目を選択肢、\[←\]ボタンを押すと、選択項目を利用可能の項目とし、「表示する」エリアに移動する。

(3) 使用可能な詳細検索条件の設定について

  - 詳細検索条件設定（Detail Search Conditions Setting）  
    検索条件に使⽤するメタデータ項⽬を選択する。
    
      - 表示内容及び設定内容は以下の通りである。
        
          - 項目（Search Item）
        
          - 使用項目（Useable Item）  
            詳細検索で利用可能な条件を設定する。
            
              - チェックボックスにチェックを入れる場合、利用可能な条件とする。
            
              - チェックボックスにチェックを入れない場合、利用不可な条件とする。
        
          - 検索条件（Condition Name）  
            項目のラベルを表示する。
        
          - JPCOARマッピング（JPCOAR Mapping）  
            該当するJPCOARマッピングの項目を表示する。
        
          - 初期選択（Initial Condition）  
            詳細検索の初期画面で表示する項目を設定する。
            
              - チェックボックスにチェックを入れる場合、該当項目を詳細検索の初期画面で表示する。
            
              - チェックボックスにチェックを入れない場合、該当項目を詳細検索の初期画面で表示しない。
        
          - 検索項目設定（Search item setting）  
            検索項目設定押下時に、検索項目設定画面をモーダル表示する。  
            詳細検索条件に指定できないメタデータの検索を行う際に使用する。ESにマッピングされているメタデータに関連づいたアイテムの検索を可能としている。  
            検索項目設定画面では、アイテムタイプをプルダウン形式で選択できる。検索したいメタデータ名をテキスト（text）1\~10、integer\_JA\_1\~5、float\_JA\_1\~5、date\_JA\_1\~5、geopoint\_JA\_1、geoshape\_JA\_1のいずれかにあらかじめ設定しておき、検索項目設定画面にて選択する。その後、検索したいマッピングの指定についての条件を画面中央下部に設定し\[保存（Save）\]ボタン押下で設定する。
            
              - メタデータ名の設定は検索したいメタデータの検索方式に応じて使い分ける。  
                テキスト（text）1\~10：文字列での検索が可能。形式はjsonもしくはxml。  
                integer\_JA\_1\~5：整数値での範囲検索が可能。形式はjsonもしくはxml。  
                float\_JA\_1\~5：小数値での範囲検索が可能。形式はjsonもしくはxml。  
                date\_JA\_1\~5：日付での範囲検索が可能。形式はjsonもしくはxml。  
                geopoint\_JA\_1：緯度，経度を指定して検索が可能。形式はjsonもしくはxml。  
                geoshape\_JA\_1：タイプと座標を指定して検索が可能。形式はjsonもしくはxml。
            
              - 上記の項目を設定し\[保存（Save）\]ボタン押下で、入力内容がdb内のsearch\_managementテーブルのsearch\_conditionsの内容が変更され、検索に反映される。
            
              - 要求された入力形式以外の文字列も入力し\[保存（Save）\]ボタンを押すことは可能であるが、入力形式に誤りがある場合は、db内のsearch\_managementテーブルのsearch\_conditionsは変更されず、検索結果にも影響を及ぼさない。

(4) インデックスツリー／ファセット検索設定

  - インデックスツリーの表示有無と、表示時の横幅と縦幅を設定する。
    
      - 「Display」：チェックボックスにチェックを入れた場合に、Web側のTop画面（メインウィジェット）の左側にインデックスツリーを表示する。  
        チェックを入れない場合はインデックスツリーは表示されない。初期値はチェックボックスにチェックを入れている（インデックスツリーを表示する）状態である。  
        インデックスツリーを表示する設定の場合、以下の設定を変更することができる。  
        ※インデックスツリーを表示しない設定の場合も変更はできるが、Top画面にインデックスツリーは表示されないため、画面上では確認できない。
        
          - 「Width」：プルダウンより横幅の値を選択する。
            
              - 選択肢：1～11　（初期値は「3」）
            
              - 単位：Grid
        
          - 「Height」：縦幅の値をテキストボックスに入力する。　（初期値は「空欄」）
            
              - 単位：pixel  
                ※縦幅の値を入力しない場合や数値以外を入力した場合、インデックスツリーの縦幅はインデックスツリーの中身に応じて自動調整とする

  - ファセット検索の表示有無を設定する。
    
      - 「Display」：チェックボックスにチェックを入れた場合、Web側のTop画面（メインウィジェット）の左側にファセット検索を表示する。  
        チェックを入れない場合、ファセット検索は表示されない。  
        初期値はチェックボックスにチェックを入れていない（ファセット検索を表示しない）状態である。  
        インデックスツリーを表示する設定の場合、ファセット検索はインデックスツリーの下側に表示される。

  - ファセット検索の詳細設定は【Administration\>設定（Setting）\>ファセット検索】で行うことができる。詳しくは[ADMIN14-12:ファセット検索](\\l)を参考。

  - コミュニティの表示有無を決定する。
    
      - 「Display」 :チェックボックスにチェックを入れた場合に、ワークフロー(Workflow)タブの横にコミュニティ(Communities)タブを表示する。タブ選択後の設定については[8 コミュニティ管理](\\l)を参照。

(5)初期表示設定(Main Screen Initial Display Setting )

  - > 初期表示画面設定：「インデックスの検索結果を表示する(Index search result)」「ランキングを表示する(Ranking)」「コミュニティを表示する(Communities)」の中から選択し設定する。設定内容は以下のようになる。
    
      - > 「インデックスの検索結果を表示する(Index search result)」：初期画面中央部にインデックスリストを一つ表示し、その下に表示しているインデックスリスト内のアイテムリストを表示する。  
        > （表示されるインデックスリストは「初期表示インデックス表示方法(Default Index to Display)」を設定することで変更可能。詳しくは後述。）
    
      - > 「ランキングを表示する(Ranking)」：初期画面中央部にランキングを表示する。詳細な表示設定については[ADMIN14-5:ランキング表示](#ランキング表示)を参照。
    
      - > 「コミュニティ一覧を表示する(Communities)」：初期画面中央部にコミュニティをリスト表示する。リスト最上部に検索用テキストボックスがあり、コミュニティ名の部分一致検索を可能としている。テキストボックスに入力後にエンターキー押下で検索をする。

<!-- end list -->

  - > 初期表示インデックス表示方法(Default Index to Display)：「最も新しい公開アイテムの属するインデックス(Index of the newest item registered)」「インデックス指定(Specific index)」のどちらかを選択し設定する。  
    > このテキストボックスは初期表示画面設定を「インデックス検索結果を表示する(Index search result)」を選択しているときのみ操作可能であり、それ以外では非活性となる。

  - > 「最も新しい公開アイテムの属するインデックス(Index of the newest item registered)」：publicなインデックスツリーの中で、最も公開日の新しいアイテムを持つインデックスが初期画面で表示される。（公開日が未来に設定されているものは除く。）

  - > 「インデックス指定(Specific index)」：選択すると、新たに「初期表示インデックス(Initial Display Index)」という項目が表示され、そこで選択したインデックスが初期表示画面に表示される。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

<!-- end list -->

  - > 処理概要

> 検索設定を一度も行っていない状態では、weko\_admin.config内のWEKO\_ADMINMANAGEMENT\_OPTIONSで設定された値がデフォルト表示されている。
> 
> Search Author Settingのラジオボタンを変更すると、weko\_admin.admin.SearchSettingsView.indexが呼び出され、設定の変更が反映される。
> 
> 検索設定の変更はweko\_admin.models.SearchManagement.updateを呼び出してDB上に反映され、それ以降の画面表示はDBの値を参照するものとする。  
> (weko\_admin.config内の設定値はDB内に設定されていない時のみ参照されている。)
> 
> 検索結果表示設定の変更は「search\_management」テーブルの以下のレコードが更新される。

  - > 「default\_dis\_num」：デフォルト表示件数変更時に更新

  - > 「default\_dis\_sort\_index」：デフォルトソート条件（インデックス検索）変更時に更新

  - > 「default\_dis\_sort\_keyword」：デフォルトソート条件（キーワード検索）変更時に更新

  - > 「sort\_setting」：表示するソート条件の変更時に更新

> 詳細検索条件設定の変更は「search\_management」テーブル内の以下のレコードが更新される。

  - > 「search\_conditions」：詳細検索条件変更時に更新

> インデックスツリー/ファセット表示設定の変更は「search\_management」テーブル内の以下のレコードが更新される。

  - > 「display\_control」：\[display\]ラジオボタン変更時に更新

> インデックスツリーの「Width」と「Height」の設定の変更は「index\_style」テーブル内のそれぞれ同名のレコードが更新される。
> 
> 初期表示設定の変更はsearch\_managementテーブル内のinit\_disp\_settingレコードが更新される。
> 
> 検索項目設定から新規の検索項目を作成した場合は、search\_managementテーブルのsearch\_conditionsが変更される。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2024/07/1</p>
</blockquote></td>
<td>7733de131da9ad59ab591b2df1c70ddefcfcad98</td>
<td>v1.0.7対応</td>
</tr>
</tbody>
</table>
