### 簡易検索（全文検索・キーワード検索）

<!-- end list -->

#### 目的・用途

本機能は、ユーザーがアイテムを検索する際に用いる機能である。  
タイトルや著者名等の項目を指定せず、全ての項目を対象に検索を行うことで、目的のアイテムを見つけることができる。

#### 利用方法

メインコンテンツ」ウィジェットの［トップ（Top）］タブにある検索テキストボックスに文字列を入力し、入力エリア右隣の［検索（Search）］ボタンを押下することで、検索結果が表示される<span id="_Item_Registration：フィードバックメール機能" class="anchor"></span>。

#### 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
</tr>
</tbody>
</table>

#### 機能内容

<!-- end list -->

  - 「メインコンテンツ」ウィジェットの「トップ」タブ画面の上部にアイテム検索エリアを設ける。

  - アイテム検索エリア
    
      - 検索テキストボックスを表示する。
    
      - 検索方式ラジオボタン（［全文（Full text）］と［キーワード（Keyword）］）を表示する。
        
          - ［全文（Full text）］ラジオボタンにチェックを入れる場合、  
            登録されたアイテムのメタデータと登録されたコンテンツの内容から検索される。
        
          - ［キーワード（Keyword）］ラジオボタンにチェックを入れる場合、  
            登録されたアイテムのメタデータから検索される。
        
          - デフォルトでは［全文（Full text）］ラジオボタンにチェックが入った状態である。
    
      - 検索テキストボックス右隣にある［検索（Search）］ボタンを押下することで、入力された文字列でアイテム検索を行う。
        
          - ［検索（Search）］ボタンを押下せず、テキストボックス内にカーソルキーがある状態でエンターキーを押下することでも検索できる。
        
          - > 検索文字列を入力しない場合、検索条件無しとする。（登録データの全件を対象とした検索となる。）
        
          - > 文字間に空白を入れることでAND検索を行うことができる。
        
          - > 以下の特殊な意味をもつ英字のみでは検索を行うことができない。  
            > a, an, and, are, as, at, be, but, by, for, if, in, into, is, it, no, not, of, on, or, such, that, the, their, then, there, these, they, this, to, was, will, with
        
          - > 以下の特殊文字は検索時に指定できる。  
            > 入力された特別文字は内部的にエスケープする。  
            > \+ - = && || \! ( ) { } \[ \] ^ " \~ \* ? : \\ /  
            > エスケープできない文字(「\<」「\>」)で検索を行った場合は、「’\<’,’\>’は検索に使用できません。」とエラーメッセージを表示する。
    
      - > \[検索（Search）\]ボタンの右にある［詳細検索（Advanced）］ボタンを押下することで、詳細検索エリアを表示する。詳細検索については[USER-1-2: 詳細検索](\\l)を参照。
    
      - 検索を行うと、検索結果がトップページ画面の検索結果エリアに表示される。

検索結果は【Administration \> 設定（Setting） \> 検索設定（Search）画面】での設定の通りに表示される。詳細については、[USER-2-1一覧形式表示](#一覧形式表示)を参照。

検索結果エリア

  - ［エクスポート（Export）］ボタンを表示する。  
    ボタンを押下すると、一括出力画面に遷移して、アイテムの情報をエクスポートできる。アイテムの一括出力については[USER-2-4: アイテム一括出力](#アイテム一括出力)を参照。

  - アイテム表示の設定エリア  
    デフォルト値について、設定されている【Administration \> 設定（Setting） \> 検索設定（Search）画面】の検索結果表示設定エリアから取得する。
    
      - ［表示順］（Display Order）プルダウンリスト：検索結果の表示順を選択する。  
        選択肢は【Administration \> 設定（Setting） \> 検索設定（Search）画面】での「表示する」リストとする。
    
      - 順序プルダウン：昇順、降順を選択する。  
        選択肢は「asc, desc」とする。
    
      - ［表示数］（Display Number）プルダウンリスト選択肢は「20,50,75,100」とする。

  - アイテム一覧表示
    
      - アイテムタイトルがリンク形式で表示される。  
        リンクをクリックすると、該当アイテム詳細画面に遷移する。
    
      - 表示されるアイテムはロールによって異なる。  
        システム管理者、リポジトリ管理者、コミュニティ管理者の場合はすべて表示される。  
        ただし、制限公開されているアイテムについては、公開日までシステム管理者と登録者のみ閲覧可能となる。  
        登録ユーザー、一般ユーザー、ゲストの場合はpublicなインデックスツリー内のpublicなアイテムのみ表示される。  
        ただし、登録ユーザーに関しては自身で登録したアイテムのみPrivateであっても検索対象となる。

  - ページング機能を設ける。
    
      - ページングナビゲーションを操作することで、表示内容が切り替わる。

<!-- end list -->

#### 関連モジュール

##### weko\_search\_ui：検索結果をUIに表示する

config.WEKO_SEARCH_UI_JSTEMPLATE_LIST_RESULTS : アイテム一覧のテンプレート

##### weko\_records

utils.sort_meta_data_by_options: 

##### weko\_items\_ui

##### weko\_theme

<!-- end list -->

#### 処理概要

> メインコンテンツ」ウィジェットの、［トップ（Top）］タブ上部にアイテム検索エリアを表示する。

  - > アイテム検索エリアには検索文字列を入力するテキストボックス、［検索（Search）］ボタン、［詳細検索（Advanced）］ボタン、全文/キーワードの検索方式を切り替えるラジオボタンを表示する。

> メインコンテンツ」ウィジェットの［トップ（Top）］タブにある検索テキストボックスに文字列を入力し、入力エリア右隣の［検索（Search）］ボタンを押下することで、weko\_search\_ui.views.searchメソッドが呼び出され、検索の処理を実行する。検索文字列を入力しない場合、登録データの全件を対象とした検索を行う。

  - > ［検索（Search）］ボタンを押下せず、テキストボックス内にカーソルキーがある状態でエンターキーを押下することでも、同様に検索処理を実行する。

> 検索処理後、メインコンテンツ」ウィジェットの［トップ（Top）］タブに検索結果エリアを表示する。検索結果エリアの表示形式はdb内のSearchManagementテーブルの情報から作成される。

  - > 検索結果エリアにはエクスポートボタン、アイテムの表示順、表示数の現在の設定、検索結果のアイテム一覧、ページングナビゲーションを表示する。

  - > 最初に検索した際は、アイテム表示に関する設定のデフォルト値として、【Administration \> 設定（Setting） \> 検索設定（Search）画面】での［検索結果表示設定］エリアで設定された値を取得し、取得した値に従って表示する。

> ［エクスポート（Export）］ボタンを押下すると一括出力画面に遷移し、アイテムの情報をエクスポートできる。アイテムの一括出力については[USER-2-4: アイテム一括出力](\\l)を参照。
> 
> アイテムタイトルのリンクをクリックすると、該当アイテムの詳細画面に遷移する。
> 
> アイテムの表示順、表示数のプルダウンを選択すると、検索結果エリアでのアイテムの表示を選択した表示順、表示数に変更する処理を行う。

#### 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2022/04/28</p>
</blockquote></td>
<td>57247ecce9b5e0879a2538687e446e0ea310129c</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>v0.9.22対応</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2024/07/1</p>
</blockquote></td>
<td>7733de131da9ad59ab591b2df1c70ddefcfcad98</td>
<td>v1.0.7対応</td>
</tr>
</tbody>
</table>
