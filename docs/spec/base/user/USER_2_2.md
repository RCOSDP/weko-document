### 目次形式表示

<!-- end list -->

  - > 目的・用途

本機能は、インデックス検索結果を表示する際の形式である「目次形式表示」を定義する機能である。

  - > 利用方法

1.【Administration \> インデックスツリー管理(Index Tree) \> ツリー編集(Edit Tree)】で編集するインデックスツリーを選ぶ。

2.「表示形式(検索結果)」の選択肢から「目次形式」を設定する。

3\. インデックスリンク検索または、インデックスツリー検索を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - > インデックス検索結果の表示は、  
    > 【Administration \> インデックスツリー管理(Index Tree) \> ツリー編集(Edit Tree)\> 】での「表示形式(検索結果)」（Display Format(Search Results)）に応じて、インデックス検索結果が表示される。  
    > また、インデックスリストについては[USER-1-3インデックス検索](#_インデックスリンク検索)を参照すること。

  - > \[アイテムリスト\]エリア
    
      - > 見出しによるグループ分け表示の条件  
        > メタデータ項目の「見出し」の設定「Show List」が"ON"かつ、その項目がアイテムに設定されている場合、アイテムリストへ表示される。
    
      - > 見出しの「Show List」設定方法
        
          - > 【Administration \> アイテムタイプ管理(Item Types) \> メタデータ(Metadata)】にてプルダウンから該当するアイテムタイプ(例：Thesis, conference paperなど)を選択する。そこのメタデータ項目「見出し」エリアの「Show List」にチェックを入れることで見出しのグループ分けがアイテムリストに表示されるようになる。既存アイテムタイプではほぼ設定されていない。
        
          - > 見出しに類するメタデータ項目が３つあり、その内設定順番が「大見出し」、「小見出し」、「言語」であるものは見出しによるグループ分けに対応している。
    
      - > 見出しのグループ分けについて
        
          - > 【Administration \> 設定(Setting) \> 検索設定(Setting) \> 検索結果表示設定】画面の項目「デフォルトソート条件(インデックス検索)」の表示順で表示される。
        
          - > 目次形式表示の時、順番を変えるプルダウンがないため、一般ユーザー側からは変えることはできない。
        
          - > アイテムが表示された際”上下で並んだアイテムが同じ見出し”であったなら見出しでグルーピングされる。見出しが設定されていないアイテムがグループ分けされているアイテムの下に来るとグループ分けされているように見える。  
            > アイテムの「見出し」プロパティの「大見出し」と「小見出し」の値でグルーピングして表示する。  
            > また、「言語」の"ja"または"en"が登録されている場合にアイテムリストに見出しの情報を表示する。
    
      - グループごとに、「大見出し」と「小見出し」の値を「:」区切りで表示する
        
          - 表示形式
            
              - {大見出し} : {小見出し}
            
              - {大見出し} 　　　　　　※小見出しの値が無い場合
            
              - : {小見出し}　　　　　 ※大見出しの値が無い場合
        
          - 「見出し」プロパティの「大見出し」と「小見出し」の値がないアイテムは、見出しがないグループとしてアイテムを配置する
        
          - アイテムの「見出し」プロパティに「言語」の"ja"または"en"が繰り返し登録されている場合、登録した先頭の各「言語」の「見出し」プロパティの値が「大見出し」と「小見出し」として表示される
        
          - 画面の表示言語が"日本語"または"English"以外の場合、登録した先頭の「言語」の「見出し」プロパティの値が「大見出し」と「小見出し」として表示される

> 論文１：　大見出しA，小見出しa
> 
> 論文２：　大見出しA，小見出しa
> 
> 論文３：　大見出しA，小見出しb
> 
> 論文４：　大見出しB，小見出しc
> 
> 論文５：　大見出しB，小見出しa
> 
> 論文６：　大見出しA，(未設定)
> 
> 論文７：　(未設定)，小見出しa
> 
> 論文８：　(未設定)，(未設定)
> 
> の場合、以下のように表示される。
> 
> 大見出しA : 小見出しa
> 
> 　論文１
> 
> 　論文２
> 
> 大見出しA : 小見出しb
> 
> 　論文３
> 
> 大見出しB : 小見出しc
> 
> 　論文４
> 
> 大見出しB : 小見出しa
> 
> 　論文５
> 
> 大見出しA
> 
> 　論文６
> 
> : 小見出しa
> 
> 　論文７
> 
> 　論文８

  - Web画面の言語を切り替えると、アイテムに登録されている見出しの言語を参照して表示する見出しの内容を変更する。  
    （例えば、アイテムに言語(ja)の見出しAと言語(en)の見出しBが登録されている場合、Web画面の言語が日本語の場合は見出しAを、英語の場合は見出しBが表示される）  
    ただし、Web画面の言語を切り替えた場合に参照する言語が無い場合は、言語を切り替えても見出しの表示は変わらない。  
    （前述の例で言語(en)が登録されていない場合は、Web画面の言語を英語にしても見出しAが表示される）

  - 同じ言語で複数の見出しがある場合は、アイテムに登録されているデータの一番目を見出しとする。  
    （例えば、アイテムに言語(ja)の見出しCと言語(ja)の見出しDが登録されており、アイテム詳細画面で見出しC, 見出しDの順で表示されている場合、アイテムリストには見出しCが表示される）

<!-- end list -->

  - タイトル  
    「一覧表示」でのタイトルと同様に表示する。

  - ページ番号  
    「書誌情報」プロパティの「開始ページ」と「終了ページ」の値を表示する。
    
      - > 以下のように表示
    
      - させる
        
          - 「開始ページ」-「終了ページ」
        
          - 「開始ページ」（終了ページを設定しない場合）
        
          - 「終了ページ」（開始ページを設定しない場合）
        
          - 表示なし（開始ページ、終了ページを設定しない場合）

【補足】

  - 目次形式において、各アイテム行の背景の色は白色固定となる。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_search\_ui：検索結果をUIに表示する

  - > weko\_index\_tree

  - > weko\_items\_ui
    
      - > weko\_records\_ui

<!-- end list -->

  - > 処理概要

> ［アイテムリスト］エリアの表示

  - > このエリアには、上部に\[エクスポート\]ボタンを配置し、その下に選択したインデックスに所属するアイテムを表示する。
    
      - > \[エクスポート（Export）］ボタンについて  
        > 押下すると一括出力画面に遷移し、アイテムの情報をエクスポートできる。アイテムの一括出力については[USER-2-4: アイテム一括出力](#アイテム一括出力)を参照すること
    
      - > アイテムリスト（目次形式）の表示
        
          - > 【Administration \> 設定（Setting） \> 検索設定（Search）画面】での［検索結果表示設定］エリアで設定された値を取得し、取得した値に従ってリンクタイトルを表示する。
        
          - > 設定された値はsearchメソッドにてsearch\_managementテーブルから取得する。また、テーブルで値が存在しない場合、初期値をmodules.weko-admin. weko\_admin.config.py内の変数WEKO\_ADMIN\_MANAGEMENT\_OPTIONSから設定する。
            
              - > 見出しのグループについて  
                > メタデータの「見出し(Heading)」が設定されていて、なおかつ「見出し(Heading)」が「Show List」の設定がONになっていた場合、アイテムごとにweko\_search\_ui.rest.getメソッドにてget\_heading\_infoを使用してrecords\_metadataテーブルから「attribute\_name」が「Heading」である「subitem\_heading\_banner\_headline」、「subitem\_heading\_headline」を取得し、それぞれ「大見出し」「小見出し」とする。大見出しと小見出しの組み合わせでグループを決める。
            
              - > グループ分けの条件  
                > 大見出し、小見出しの組み合わせが一致し、なおかつ上下に並んでいるとき同じグループで分けられる。
            
              - > 「Show List」設定について  
                > 【Administration \> アイテムタイプ管理(Item Types) \> メタデータ(Metadata)】にてプルダウンから該当するアイテムタイプ(例：Thesis, conference paperなど)を選択する。メタデータ項目「見出し」エリアの「Show List」にチェックを入れることで表示されるようになる。デフォルトではほぼ設定されていない。設定はitem\_typeテーブルのrender列の中のキー「showlist」に保存され、その値でweko\_search\_ui.rest.getメソッドにて表示の可否を決めている。
        
          - > ページ番号  
            > 「書誌情報」プロパティの「開始ページ」と「終了ページ」の値を表示する。なお、「開始ページ」のみある場合は「開始ページ」のみを、「終了ページ」のみある場合は「終了ページ」のみを表示する。  
            > どちらも設定されていない場合、ページ番号は表示されない。  
            > なお、「開始ページ」と「終了ページ」はweko\_search\_ui.rest.get にてrecords\_metadataテーブルの「Page Start」「Page End」から取得し、表示する。
        
          - > アイテムタイトルのリンクをクリックすると、該当アイテムの詳細画面に遷移する。アイテム詳細画面の処理については[USER-3-1 メタデータ表示](\\l)を参照すること。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>