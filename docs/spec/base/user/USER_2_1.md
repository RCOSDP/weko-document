### 一覧形式表示

  - > 目的・用途

本機能は、検索結果を「一覧形式表示」の形式で表示する機能である。

  - > 利用方法

1.【Administration \> インデックスツリー管理(Index Tree) \> ツリー編集(Edit Tree) 】の編集するインデックスツリーを選択する。

2.「表示形式(検索結果)」の選択肢から「一覧形式」を設定する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
</tr>
</tbody>
</table>

  - > 機能内容

1検索結果を表示する

  - > 簡易検索、詳細検索は一覧形式表示である。  
    > また、インデックス検索結果の表示は、  
    > 【Administration \> インデックスツリー管理(Index Tree) \> ツリー編集(Edit Tree)\> 】での「表示形式(検索結果)」（Display Format(Search Results)）に応じて、インデックス検索結果が表示される。  
    > インデックスリストについての記述は[USER-1-3インデックス検索](\\l)を参照すること。\[アイテムリスト\]エリア
    
      - アイテムの検索結果は【Administration \> 設定（Setting） \> 検索設定（Search）画面】の［検索結果表示設定］の通りに表示される。設定については[ADMIN-14-11: 検索設定](\\l)を参照すること。
    
      - ［エクスポート（Export）］ボタンを表示する。  
        ボタンを押下すると、一括出力画面に遷移して、アイテムの情報をエクスポートできる。アイテムの一括出力については[USER-2-4: アイテム一括出力](#アイテム一括出力)を参照すること。
    
    <!-- end list -->
    
      - アイテム表示の設定エリア  
        デフォルト値について、設定されている【Administration \> 設定（Setting） \> 検索設定（Search）画面】での「検索結果表示設定」エリアから取得する。
        
          - 「表示順」（Display Order）プルダウンリスト：検索結果の表示順を選択する。  
            選択肢は【Administration \> 設定（Setting） \> 検索設定（Search）画面】での「表示する」リストとする。
        
          - 順序プルダウン：昇順、降順を選択する  
            選択肢は「asc, desc」とする。
        
          - 「表示数」（Display Number）プルダウンリスト  
            選択肢は「20,50,75,100」とする。
    
      - アイテムリスト一覧
        
          - アイテムタイトルがリンク形式で表示される。  
            リンクをクリックすると、該当アイテム詳細画面に移動する。
        
          - アイテムリストに表示されるタイトルリンクの表示言語は、以下の表示順に従う。
        
          - 優先度は「Web画面の表示言語＞ローマ字＞英語＞アイテム登録時の１つ目の言語＞言語無しで登録した時の１つ目の値」とする。
        
          - アイテムタイトルの下に「Show List」の設定がONになっているメタデータを表示する。設定方法の詳細は[ADMIN-1-1 メタデータ](#メタデータ)を参照すること。簡易なものを次ページで記述する。

  - 同じ言語の値が複数ある場合は、アイテム詳細画面の表示順とあわせて、１つ目のプロパティの値を表示する。

  - ページング機能を設ける。
    
      - ページングナビゲーションを操作することで、表示内容が切り替わる。

  - アイテムリストの表示仕様について
    
      - "Root Index"表示時
        
          - 「アイテムリスト(Item Lists)」エリアは非表示(エリアごと表示しない)とする  
            ※"Root Index"にリンクを持つアイテムは無いため
        
          - コミュニティ画面の"Root Index"は「アイテムリスト(Item Lists)」エリアを表示する。  
            ※リポジトリの"Root Index"では無いため
    
      - "Root Index"以外のインデックス表示時
        
          - 該当のインデックスにリンクを持つアイテムがある場合、「アイテムリスト(Item Lists)」エリアを表示し、リンクするアイテムを表示する。
        
          - 該当のインデックスにリンクを持つアイテムが無い場合、「アイテムリスト(Item Lists)」エリアは表示する。ただし、\[エクスポート(Export)\]ボタン，表示順(Display Order)，表示数(Display Number)のプルダウン項目は非表示とする。（エリアのみ表示される）※エクスポートする対象となるアイテムが表示されている場合にエクスポートボタンを表示する仕様のため。表示順・表示数も同様。

  - アイテムリストのメタデータ表示仕様について
    
      - > メタデータ表示条件  
        > メタデータ項目の設定「Show List」が"ON"かつ、その項目がメタデータとしてアイテムに設定されている場合、アイテムリストへ表示される。
    
      - > 「Show List」の設定方法  
        > 【Administration \> アイテムタイプ管理(Item Types) \> メタデータ(Metadata)】画面で編集したいアイテムタイプを選択後、各メタデータのオプションの「Show List」の設定をチェックする。
    
      - > その他のプロパティ設定については[ADMIN-1-1 メタデータ](#メタデータ)を参照すること
    
      - > 1つも「Show List」がONになっていない場合、アイテムリストでのメタデータの表示内容は空となる。
    
      - > 「Specify Newline」について  
        > 「Show List」の設定がONのとき、各プロパティのオプション「Specify Newline」の設定のON/OFFを選択することができる。この設定によって、アイテムリストのメタデータの出力方法が異なる。
        
          - > 「Specify Newline」をONにすることでアイテムリストに表示される際、ONにしたメタデータの上に改行を入れて表示される。OFFの場合は「,」で区切られて横に並べて表示される。
            
              - 「Specify Newline」の設定がONの場合  
                出力されるプロパティの項目の値は単独1行で表示される。  
                例えば、「ページ数」と「終了ページ」のみ、「Show List」がＯＮになっていて、かつ、「終了ページ」のみが「Specify Newline」がＯＮの時、「ページ数」の項目が「1000」, 「終了ページ」の項目が「123」の場合、アイテムリストには以下のように表示される。

> 1000
> 
> 123

  - 「Specify Newline」の設定がOFF  
    出力されるプロパティの項目の値は「,」区切りで表示される  
    例えば、「ページ数」の項目が「1000」, 「終了ページ」の項目が「123」の場合、アイテムリストには以下のように表示される。

> 1000,123

  - アイテムリストの各アイテム情報表示時、リンクタイトルは各アイテム情報表示の最状部に表示される。

  - コンテンツファイルがある場合  
    ファイル情報が拡張子のリンク形式で表示される。  
    リンクをマウスオーバーすると、登録されているコンテンツファイルのラベル（無い場合はファイル名）が表示される。  
    拡張子のリンクを押下すると、該当のコンテンツファイルがダウンロードされる。  
    コンテンツファイルがあるが拡張子が無い場合、ファイル情報が"unknown"のリンク形式で表示される。

  - コンテンツファイルが無い場合、  
    ファイル情報が"URL"のリンク形式で表示される。  
    リンクをマウスオーバーすると、登録されているコンテンツファイルのラベル（無い場合はファイル名）が表示される。  
    "URL"のリンクを押下すると、該当のURLのリンク先へ遷移する。

  - オプション機能の変更  
    親プロパティの「Show List」のみ操作可能である。

  - 複数表示の場合、  
    アイテムに複数のコンテンツファイルやURLが登録されている場合、横並びで拡張子やURLのリンクが表示される。  
    表示する順序はアイテム詳細画面の順序と同じである。  
    アイテムリストの枠を超えるコンテンツファイル数がある場合は「…」と表示する。  
    「…」を押下するとアイテム詳細画面に遷移する。

  - サムネイルファイルについて  
    アイテムにサムネイルファイルがアップロードされている場合、アイテムリストにサムネイルファイルを表示する。
    
      - アイテムタイプのサムネイルプロパティのオプションで「Show List」が"ON"になっているときに、アイテムリストへアップロードされたサムネイルファイルを表示する。
    
      - 表示する位置は ファイル情報の左上側とし、右側にアイテムの情報を表示する。
    
      - アイテムに複数のサムネイルファイルがアップロードされている場合、アイテム詳細画面の１つ目のサムネイルファイルを表示する。
    
      - サムネイルファイルの画像の表示サイズについて、以下のConfigファイルで設定する。（アイテム詳細画面と同じ設定。初期値は100px）
    
      - <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/config.py#L310>  
        「WEKO\_RECORDS\_UI\_DEFAULT\_MAX\_WIDTH\_THUMBNAIL = 100」
    
      - アップロードされているサムネイルファイルの画像の横幅が設定値を超える場合、横幅は設定値に自動調整し、あわせて縦の長さも元の画像の比率にあわせて自動調整する。
    
      - サムネイルを表示するエリアは固定とし、アイテムリストの幅を狭くしても、サムネイルを表示するエリアは変更しないものとする。

<!-- end list -->

  - Show Listにチェックがある場合、言語の表示順に従ってタイトルを表示する。

  - タイトルが複数ある場合は、他の項目と同様、１つだけ表示する。

  - 言語の表示順は上記と同様、「Web画面の表示言語＞英語＞アイテム登録時の１つ目の言語＞言語無しで登録した時の１つ目の値」とする。

  - タイトルプロパティに言語がある場合の表示条件は以下に従う

<table>
<thead>
<tr class="header">
<th>　</th>
<th>プロパティの<br />
Show Listチェック有</th>
<th>プロパティの<br />
Show Listチェック無し</th>
<th>タイトル属性のみ<br />
Show Listチェック有</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>アイテム<br />
リスト</td>
<td>日本語</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
<tr class="even">
<td></td>
<td>English</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
<tr class="odd">
<td>検索結果</td>
<td>日本語</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
<tr class="even">
<td></td>
<td>English</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
</tbody>
</table>

  - タイトルプロパティに言語が無い場合の表示条件は以下に従う

<table>
<thead>
<tr class="header">
<th>　</th>
<th>プロパティの<br />
Show Listチェック有</th>
<th>プロパティの<br />
Show Listチェック無し</th>
<th>タイトル属性の<br />
Show Listチェック有</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>アイテム<br />
リスト</td>
<td>日本語</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
<tr class="even">
<td></td>
<td>English</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
<tr class="odd">
<td>検索結果</td>
<td>日本語</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
<tr class="even">
<td></td>
<td>English</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
<td>タイトルは表示されないこと</td>
<td>表示順に従って<br />
タイトルが1回表示されること</td>
</tr>
</tbody>
</table>

  - > 関連モジュール

<!-- end list -->

  - > weko\_search\_ui

  - > weko\_items\_ui

  - > weko\_records\_ui
    
      - > invenio\_records\_rest

<!-- end list -->

  - > 処理概要

> ［アイテムリスト］エリアの表示

  - > このエリアには、\[エクスポート\]ボタン、表示順プルダウンを２つ、表示数プルダウンを１つ上部に配置し、それらの下に選択したインデックスに所属するアイテムを表示する。
    
      - > \[エクスポート（Export）］ボタンについて  
        > 押下すると一括出力画面に遷移し、アイテムの情報をエクスポートできる。アイテムの一括出力については[USER-2-4: アイテム一括出力](#アイテム一括出力)を参照すること
    
      - > 表示順プルダウンについて
        
          - > アイテムの表示順の現在の設定を表示する。
        
          - > アイテム表示に関する設定のデフォルト値として、【Administration \> 設定（Setting） \> 検索設定（Search）画面】での［検索結果表示設定］エリアで設定された値を取得し、取得した値に従って表示する。
        
          - > 設定された値はsearchメソッドにてsearch\_managementテーブルから取得する。また、テーブルに値が存在していない場合、初期値をmodules.weko-admin.weko\_admin.config.py内の変数WEKO\_ADMIN\_MANAGEMENT\_OPTIONSから設定する。
    
      - > アイテムの表示について  
        > 検索結果を表示する際、以下の処理を行う。
        
          - > invenio\_records\_rest.serializers.response.search\_responsifyを呼び出す。このメソッド下でsort\_meta\_data\_by\_optionsメソッドを呼び出し、item\_typeテーブルのrender列の中のキー「showlist」と「isSpecifyNewline」を参照する。それらの値からリンク下に表示するメタデータ情報を生成し、表示する。

> アイテムタイトルのリンクをクリックすると、該当アイテムの詳細画面に遷移する。アイテム詳細画面の処理については[USER-3-1 メタデータ表示](#メタデータ表示)を参照すること。
> 
> アイテムの表示順のプルダウンを選択すると、［アイテムリスト］エリアでのアイテムの表示を選択した表示順に変更する処理を行う。また、表示数のプルダウンを選択すると、選択した表示数に変更する処理を行う。表示数変更の処理はページリロードを伴う。  
> weko-search-ui.weko\_search\_ui.templates.weko\_search\_ui.body\_contentsを参照すること。

  - 
<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>